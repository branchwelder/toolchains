(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))s(o);new MutationObserver(o=>{for(const i of o)if(i.type==="childList")for(const r of i.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&s(r)}).observe(document,{childList:!0,subtree:!0});function e(o){const i={};return o.integrity&&(i.integrity=o.integrity),o.referrerPolicy&&(i.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?i.credentials="include":o.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function s(o){if(o.ep)return;o.ep=!0;const i=e(o);fetch(o.href,i)}})();const rt="modulepreload",lt=function(n){return"/toolchains/"+n},R={},P=function(t,e,s){if(!e||e.length===0)return t();const o=document.getElementsByTagName("link");return Promise.all(e.map(i=>{if(i=lt(i),i in R)return;R[i]=!0;const r=i.endsWith(".css"),d=r?'[rel="stylesheet"]':"";if(!!s)for(let f=o.length-1;f>=0;f--){const l=o[f];if(l.href===i&&(!r||l.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${i}"]${d}`))return;const a=document.createElement("link");if(a.rel=r?"stylesheet":rt,r||(a.as="script",a.crossOrigin=""),a.href=i,document.head.appendChild(a),r)return new Promise((f,l)=>{a.addEventListener("load",f),a.addEventListener("error",()=>l(new Error(`Unable to preload CSS for ${i}`)))})})).then(()=>t())},at=(n,t)=>{const e=n[t];return e?typeof e=="function"?e():Promise.resolve(e):new Promise((s,o)=>{(typeof queueMicrotask=="function"?queueMicrotask:setTimeout)(o.bind(null,new Error("Unknown variable dynamic import: "+t)))})};/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */var M;const N=window,b=N.trustedTypes,B=b?b.createPolicy("lit-html",{createHTML:n=>n}):void 0,y=`lit$${(Math.random()+"").slice(9)}$`,F="?"+y,ct=`<${F}>`,x=document,S=(n="")=>x.createComment(n),T=n=>n===null||typeof n!="object"&&typeof n!="function",W=Array.isArray,dt=n=>W(n)||typeof(n==null?void 0:n[Symbol.iterator])=="function",k=/<(?:(!--|\/[^a-zA-Z])|(\/?[a-zA-Z][^>\s]*)|(\/?$))/g,Z=/-->/g,U=/>/g,_=RegExp(`>|[ 	
\f\r](?:([^\\s"'>=/]+)([ 	
\f\r]*=[ 	
\f\r]*(?:[^ 	
\f\r"'\`<>=]|("|')|))|$)`,"g"),V=/'/g,q=/"/g,J=/^(?:script|style|textarea|title)$/i,ut=n=>(t,...e)=>({_$litType$:n,strings:t,values:e}),m=ut(1),H=Symbol.for("lit-noChange"),p=Symbol.for("lit-nothing"),Y=new WeakMap,A=x.createTreeWalker(x,129,null,!1),ht=(n,t)=>{const e=n.length-1,s=[];let o,i=t===2?"<svg>":"",r=k;for(let c=0;c<e;c++){const a=n[c];let f,l,u=-1,h=0;for(;h<a.length&&(r.lastIndex=h,l=r.exec(a),l!==null);)h=r.lastIndex,r===k?l[1]==="!--"?r=Z:l[1]!==void 0?r=U:l[2]!==void 0?(J.test(l[2])&&(o=RegExp("</"+l[2],"g")),r=_):l[3]!==void 0&&(r=_):r===_?l[0]===">"?(r=o??k,u=-1):l[1]===void 0?u=-2:(u=r.lastIndex-l[2].length,f=l[1],r=l[3]===void 0?_:l[3]==='"'?q:V):r===q||r===V?r=_:r===Z||r===U?r=k:(r=_,o=void 0);const v=r===_&&n[c+1].startsWith("/>")?" ":"";i+=r===k?a+ct:u>=0?(s.push(f),a.slice(0,u)+"$lit$"+a.slice(u)+y+v):a+y+(u===-2?(s.push(void 0),c):v)}const d=i+(n[e]||"<?>")+(t===2?"</svg>":"");if(!Array.isArray(n)||!n.hasOwnProperty("raw"))throw Error("invalid template strings array");return[B!==void 0?B.createHTML(d):d,s]};class E{constructor({strings:t,_$litType$:e},s){let o;this.parts=[];let i=0,r=0;const d=t.length-1,c=this.parts,[a,f]=ht(t,e);if(this.el=E.createElement(a,s),A.currentNode=this.el.content,e===2){const l=this.el.content,u=l.firstChild;u.remove(),l.append(...u.childNodes)}for(;(o=A.nextNode())!==null&&c.length<d;){if(o.nodeType===1){if(o.hasAttributes()){const l=[];for(const u of o.getAttributeNames())if(u.endsWith("$lit$")||u.startsWith(y)){const h=f[r++];if(l.push(u),h!==void 0){const v=o.getAttribute(h.toLowerCase()+"$lit$").split(y),g=/([.?@])?(.*)/.exec(h);c.push({type:1,index:i,name:g[2],strings:v,ctor:g[1]==="."?ft:g[1]==="?"?$t:g[1]==="@"?vt:C})}else c.push({type:6,index:i})}for(const u of l)o.removeAttribute(u)}if(J.test(o.tagName)){const l=o.textContent.split(y),u=l.length-1;if(u>0){o.textContent=b?b.emptyScript:"";for(let h=0;h<u;h++)o.append(l[h],S()),A.nextNode(),c.push({type:2,index:++i});o.append(l[u],S())}}}else if(o.nodeType===8)if(o.data===F)c.push({type:2,index:i});else{let l=-1;for(;(l=o.data.indexOf(y,l+1))!==-1;)c.push({type:7,index:i}),l+=y.length-1}i++}}static createElement(t,e){const s=x.createElement("template");return s.innerHTML=t,s}}function w(n,t,e=n,s){var o,i,r,d;if(t===H)return t;let c=s!==void 0?(o=e._$Co)===null||o===void 0?void 0:o[s]:e._$Cl;const a=T(t)?void 0:t._$litDirective$;return(c==null?void 0:c.constructor)!==a&&((i=c==null?void 0:c._$AO)===null||i===void 0||i.call(c,!1),a===void 0?c=void 0:(c=new a(n),c._$AT(n,e,s)),s!==void 0?((r=(d=e)._$Co)!==null&&r!==void 0?r:d._$Co=[])[s]=c:e._$Cl=c),c!==void 0&&(t=w(n,c._$AS(n,t.values),c,s)),t}class pt{constructor(t,e){this.u=[],this._$AN=void 0,this._$AD=t,this._$AM=e}get parentNode(){return this._$AM.parentNode}get _$AU(){return this._$AM._$AU}v(t){var e;const{el:{content:s},parts:o}=this._$AD,i=((e=t==null?void 0:t.creationScope)!==null&&e!==void 0?e:x).importNode(s,!0);A.currentNode=i;let r=A.nextNode(),d=0,c=0,a=o[0];for(;a!==void 0;){if(d===a.index){let f;a.type===2?f=new I(r,r.nextSibling,this,t):a.type===1?f=new a.ctor(r,a.name,a.strings,this,t):a.type===6&&(f=new gt(r,this,t)),this.u.push(f),a=o[++c]}d!==(a==null?void 0:a.index)&&(r=A.nextNode(),d++)}return i}p(t){let e=0;for(const s of this.u)s!==void 0&&(s.strings!==void 0?(s._$AI(t,s,e),e+=s.strings.length-2):s._$AI(t[e])),e++}}class I{constructor(t,e,s,o){var i;this.type=2,this._$AH=p,this._$AN=void 0,this._$AA=t,this._$AB=e,this._$AM=s,this.options=o,this._$Cm=(i=o==null?void 0:o.isConnected)===null||i===void 0||i}get _$AU(){var t,e;return(e=(t=this._$AM)===null||t===void 0?void 0:t._$AU)!==null&&e!==void 0?e:this._$Cm}get parentNode(){let t=this._$AA.parentNode;const e=this._$AM;return e!==void 0&&t.nodeType===11&&(t=e.parentNode),t}get startNode(){return this._$AA}get endNode(){return this._$AB}_$AI(t,e=this){t=w(this,t,e),T(t)?t===p||t==null||t===""?(this._$AH!==p&&this._$AR(),this._$AH=p):t!==this._$AH&&t!==H&&this.g(t):t._$litType$!==void 0?this.$(t):t.nodeType!==void 0?this.T(t):dt(t)?this.k(t):this.g(t)}O(t,e=this._$AB){return this._$AA.parentNode.insertBefore(t,e)}T(t){this._$AH!==t&&(this._$AR(),this._$AH=this.O(t))}g(t){this._$AH!==p&&T(this._$AH)?this._$AA.nextSibling.data=t:this.T(x.createTextNode(t)),this._$AH=t}$(t){var e;const{values:s,_$litType$:o}=t,i=typeof o=="number"?this._$AC(t):(o.el===void 0&&(o.el=E.createElement(o.h,this.options)),o);if(((e=this._$AH)===null||e===void 0?void 0:e._$AD)===i)this._$AH.p(s);else{const r=new pt(i,this),d=r.v(this.options);r.p(s),this.T(d),this._$AH=r}}_$AC(t){let e=Y.get(t.strings);return e===void 0&&Y.set(t.strings,e=new E(t)),e}k(t){W(this._$AH)||(this._$AH=[],this._$AR());const e=this._$AH;let s,o=0;for(const i of t)o===e.length?e.push(s=new I(this.O(S()),this.O(S()),this,this.options)):s=e[o],s._$AI(i),o++;o<e.length&&(this._$AR(s&&s._$AB.nextSibling,o),e.length=o)}_$AR(t=this._$AA.nextSibling,e){var s;for((s=this._$AP)===null||s===void 0||s.call(this,!1,!0,e);t&&t!==this._$AB;){const o=t.nextSibling;t.remove(),t=o}}setConnected(t){var e;this._$AM===void 0&&(this._$Cm=t,(e=this._$AP)===null||e===void 0||e.call(this,t))}}class C{constructor(t,e,s,o,i){this.type=1,this._$AH=p,this._$AN=void 0,this.element=t,this.name=e,this._$AM=o,this.options=i,s.length>2||s[0]!==""||s[1]!==""?(this._$AH=Array(s.length-1).fill(new String),this.strings=s):this._$AH=p}get tagName(){return this.element.tagName}get _$AU(){return this._$AM._$AU}_$AI(t,e=this,s,o){const i=this.strings;let r=!1;if(i===void 0)t=w(this,t,e,0),r=!T(t)||t!==this._$AH&&t!==H,r&&(this._$AH=t);else{const d=t;let c,a;for(t=i[0],c=0;c<i.length-1;c++)a=w(this,d[s+c],e,c),a===H&&(a=this._$AH[c]),r||(r=!T(a)||a!==this._$AH[c]),a===p?t=p:t!==p&&(t+=(a??"")+i[c+1]),this._$AH[c]=a}r&&!o&&this.j(t)}j(t){t===p?this.element.removeAttribute(this.name):this.element.setAttribute(this.name,t??"")}}class ft extends C{constructor(){super(...arguments),this.type=3}j(t){this.element[this.name]=t===p?void 0:t}}const mt=b?b.emptyScript:"";class $t extends C{constructor(){super(...arguments),this.type=4}j(t){t&&t!==p?this.element.setAttribute(this.name,mt):this.element.removeAttribute(this.name)}}class vt extends C{constructor(t,e,s,o,i){super(t,e,s,o,i),this.type=5}_$AI(t,e=this){var s;if((t=(s=w(this,t,e,0))!==null&&s!==void 0?s:p)===H)return;const o=this._$AH,i=t===p&&o!==p||t.capture!==o.capture||t.once!==o.once||t.passive!==o.passive,r=t!==p&&(o===p||i);i&&this.element.removeEventListener(this.name,this,o),r&&this.element.addEventListener(this.name,this,t),this._$AH=t}handleEvent(t){var e,s;typeof this._$AH=="function"?this._$AH.call((s=(e=this.options)===null||e===void 0?void 0:e.host)!==null&&s!==void 0?s:this.element,t):this._$AH.handleEvent(t)}}class gt{constructor(t,e,s){this.element=t,this.type=6,this._$AN=void 0,this._$AM=e,this.options=s}get _$AU(){return this._$AM._$AU}_$AI(t){w(this,t)}}const X=N.litHtmlPolyfillSupport;X==null||X(E,I),((M=N.litHtmlVersions)!==null&&M!==void 0?M:N.litHtmlVersions=[]).push("2.6.1");const K=(n,t,e)=>{var s,o;const i=(s=e==null?void 0:e.renderBefore)!==null&&s!==void 0?s:t;let r=i._$litPart$;if(r===void 0){const d=(o=e==null?void 0:e.renderBefore)!==null&&o!==void 0?o:null;i._$litPart$=r=new I(t.insertBefore(S(),d),d,void 0,e??{})}return r._$AI(n),r},yt={"--pink":"#ff79c6","--red":"#ff5555","--orange":"#ffad55","--yellow":"#f1fa8c","--green":"#50fa7b","--cyan":"#8be9fd","--blue":"#4395d4","--purple":"#9674c8","--gray":"#848484","--black":"#282a36","--text-light":"#f8f8f2","--text-dark":"#282a36","--pipe":"#b7b7b7","--workspace-background":"#44475a","--toolbar":"#282a36","--module-background":"#f8f8f2","--module-background-accent":"#d5d5d5","--background-dots":"#d6cce0","--port":"#b7b7b7"},G=n=>n.composedPath()[0],_t=(n,t)=>G(n).matches(t),Q=n=>(t,e,s)=>{n.addEventListener(t,o=>{o.trigger=G(o),(e===""||_t(o,e))&&s(o)})};function At(n,t){const e=Q(n);let s=!1,o=1,i=0,r=0,d={x:0,y:0};function c(l){l.style.transformOrigin=`${0}px ${0}px`,l.style.transform="translate("+i+"px, "+r+"px) scale("+o+")"}function a({x:l,y:u}){let h=(l-i)/o,v=(u-r)/o;return{x:h,y:v}}e("pointerdown","",l=>{l.shiftKey||(s=!0,d={x:l.offsetX-i,y:l.offsetY-r},l.detail)}),e("pointermove","",l=>{if(!s||t.transforming)return;i=l.offsetX-d.x,r=l.offsetY-d.y;const u=document.querySelectorAll(".transform-group");for(const h of u)c(h)}),e("pointerup","",l=>{s=!1}),e("wheel","",l=>{let u=(l.offsetX-i)/o,h=(l.offsetY-r)/o;Math.sign(l.deltaY)<0?o*=1.03:o/=1.03,i=l.offsetX-u*o,r=l.offsetY-h*o;const v=document.querySelectorAll(".transform-group");for(const g of v)c(g);l.preventDefault()});function f(l){const u=n.getBoundingClientRect(),h=l.x[1]-l.x[0],v=l.y[1]-l.y[0],g=u.width/h,nt=u.height/v,L=Math.min(g,nt)*.9;o=L;const D={x:(l.x[0]+l.x[1])/2*L-u.width/2,y:(l.y[0]+l.y[1])/2*L-u.height/2};i=-D.x,r=-D.y;const st=document.querySelectorAll(".transform-group");for(const it of st)c(it)}return{scale:()=>o,x:()=>i,y:()=>r,setScaleXY:f,svgPoint:a}}function bt(n,t){const e=Q(n);function s(o){let i=o.target.closest(".mod").dataset.toolid;return[i,t.toolchain.modules[i]]}e("pointerdown",".remove",o=>{let[i,r]=s(o);console.log(`Removing ${i}`),delete t.toolchain.modules[i]}),e("pointerdown",".drag",o=>{let[i,r]=s(o);t.selection.add(i),t.transforming=!0}),e("pointermove","",o=>{if(!t.transforming)return;let i=o.movementX/t.panZoom.scale(),r=o.movementY/t.panZoom.scale();t.selection.forEach(d=>{t.toolchain.modules[d].pos.x+=i,t.toolchain.modules[d].pos.y+=r})}),e("pointerup","",o=>{t.selection.clear(),t.transforming=!1}),e("pointerdown",".pin",o=>{let[i,r]=s(o);r.uiState.toolbar=!r.uiState.toolbar}),e("pointerdown",".toggle-state",o=>{let[i,r]=s(o);r.uiState.statePanel=!r.uiState.statePanel,console.log("Toggle state")}),e("pointerdown",".outports .port",o=>{let[i,r]=s(o);const d=o.target.dataset.portid;console.log(`${i} outport ${d}`)}),e("pointerdown",".inports .port",o=>{let[i,r]=s(o);const d=o.target.dataset.portid;console.log(`${i} inport ${d}`)})}function*xt(n,t){let e=!0;for(const s of n)e||(yield t),e=!1,yield s}const wt=m`,`,kt=m`[`,St=m`]`;function Tt(n){if(Array.isArray(n))return Ht(n);if(!n)return Et();let t=[];for(const[e,s]of Object.entries(n))t.push(m`
        <span class="state-key">${e}:</span>
        <span class="state-value">${j(s)}</span>
      `);return m`<div class="keyval-container">${t}</div>`}function Ht(n){let t=[];for(const s of n)t.push(j(s));return[kt,...xt(t,wt),St]}function Et(){return m`<span class="undef">null</span>`}function It(n){return m`<span class="number">${n}</span>`}function Pt(n){return m`<span class="string">${n}</span>`}function Ot(n){return m`<span class="boolean">${n}</span>`}function Nt(n){return m`<span>undef</span>`}function j(n){let t;switch(typeof n){case"object":t=Tt(n);break;case"number":t=It(n);break;case"string":t=Pt(n);break;case"boolean":t=Ot(n);break;case"undefined":t=Nt();break}return t}function Ct(n){let t=[];for(const[e,s]of Object.entries(n))t.push(m` <span class="state-key">${e}</span>
        <span class="state-value">${j(s)}</span>`);return t}function Lt(n){return m` <div class="state-container">${Ct(n)}</div>`}function z(n,t){return m`<div class="port" data-portid=${n} title=${n}></div>`}function Mt(n,t){return m`<div
    class="mod ${t.uiState.toolbar?"show-toolbar":"hide-toolbar"} ${t.uiState.statePanel?"show-state":"hide-state"}"
    data-toolid=${n}
    style="
      --x:${t.pos.x}px;
      --y:${t.pos.y}px;
      --ui-width:${t.ui.width};
      --ui-height:${t.ui.height};">
    <div class="module-background">
      <div class="b1"></div>
      <div class="b2"></div>
      <div class="b3"></div>
    </div>
      <div class="toolbar">
        <span class="module-displayname">${t.ui.displayName}</span>
        <span class="module-actions">
          <i class="toggle-state fa-solid fa-code fa-xs "></i>
          <i class="remove fa-solid fa-rectangle-xmark"></i>
          <i class="pin fa-solid fa-xs fa-thumbtack"></i>
          <i class="drag fa-solid fa-grip-vertical"></i>
        </span>
      </div>
      <div class="inports port-container">
        ${Object.entries(t.inports).map(([e,s])=>z(e))}
      </div>
      <div class="outports port-container">
        ${Object.entries(t.outports).map(([e,s])=>z(e))}
      </div>
      <div class="tool-view">${t.render()}</div>
      <div class="module-state">${Lt(t.state)}</div>
    </div>
  </div>`}let $={initialized:!1,toolbox:["test","color","toggle","text"],imports:{},toolchain:{modules:{},shape:{}},theme:yt,panZoom:null,transforming:!1,selection:new Set},jt={moduleClass:null,inports:{},outports:{},state:{},lifecycle:{},ui:{displayName:null,height:"100px",width:"100px"},pos:{x:0,y:0},focus:!1,uiState:{toolbar:!0,statePanel:!1}};const Dt=(n,t)=>{console.log(`${n} says: ${t}`)},Rt=n=>({log:t=>Dt(n,t)});let O=0;function Bt(n){return Object.entries(n.toolchain.modules).map(([t,e])=>Mt(t,e))}const tt=n=>{const t=n.panZoom?n.panZoom.x():0,e=n.panZoom?n.panZoom.y():0,s=n.panZoom?n.panZoom.scale():1;return m`<div id="app-container">
    <div id="top-bar"><span>toolchains</span></div>
    <div id="workspace">
      <canvas
        id="background"
        style="--offset-x: ${t}px;--offset-y: ${e}px;--scale: ${s}"></canvas>
      <div id="modules" class="transform-group">${Bt(n)}</div>
      <div id="toolbox">
        <div id="toolbox-title">toolbox</div>
        ${n.toolbox.map(o=>m`<button class="add-tool" @click=${()=>Ut(o)}>
              ${o}
            </button>`)}
      </div>
    </div>
  </div>`};function et(n){const t=$.imports[n];let e=`${n}_${O}`,s=JSON.parse(JSON.stringify(jt));s.pos.x+=O*30,s.pos.y+=O*30,Object.assign(s,t(Rt(e))),"init"in s&&s.init(),$.toolchain.modules[e]=s,O++}async function Zt(n){const{default:t}=await at(Object.assign({"./tools/color.js":()=>P(()=>import("./color-8923157a.js"),[]),"./tools/test.js":()=>P(()=>import("./test-33503523.js"),[]),"./tools/text.js":()=>P(()=>import("./text-36be19a8.js"),[]),"./tools/toggle.js":()=>P(()=>import("./toggle-5774acfb.js"),[])}),`./tools/${n}.js`);$.imports[n]=t,et(n)}async function Ut(n){n in $.imports?et(n,$.imports[n].lifecycle):Zt(n)}function Vt(){Object.entries($.theme).map(([n,t])=>{document.documentElement.style.setProperty(n,t)})}function ot(){K(tt($),document.body),window.requestAnimationFrame(ot)}function qt(){if($.initialized)return;let n=window.innerHeight*.01;document.documentElement.style.setProperty("--vh",`${n}px`),$.initialized=!0,Vt(),K(tt($),document.body)}window.addEventListener("resize",()=>{let n=window.innerHeight*.01;document.documentElement.style.setProperty("--vh",`${n}px`)});qt();const Yt=document.getElementById("background"),Xt=document.getElementById("workspace"),zt=At(Yt,$);$.panZoom=zt;bt(Xt,$);window.requestAnimationFrame(ot);export{m as y};
